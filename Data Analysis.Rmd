---
title: "Data Analysis"
author: "Sydney Sorkin"
date: "12/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

cdc_data <- load("cdc_cleaned.RData")

nationscape <- load("nationscape_cleaned.RData")
```

```{r, merge data}

cleaned_merged <- full_join(combined_final, cdc_cleaned, by = "date") %>% 
  mutate(covid_concern = case_when(
    extra_corona_concern == 1 ~ 4,
    extra_corona_concern == 2 ~ 3,
    extra_corona_concern == 3 ~ 2,
    extra_corona_concern == 4 ~ 1))

save(cleaned_merged, file = "cleaned_merged.RData")
```

```{r, load merged data}


load("cleaned_merged.RData")

```



```{r}

analysis <- cleaned_merged %>%
  #COVID concern variable; concerned if responded 1 or 2
  
  mutate(COVID_concern = ifelse(extra_corona_concern == 1 | extra_corona_concern == 2, 1, 0)) %>% 
  group_by(date) %>% 
  mutate(prop_concerned_daily = sum(COVID_concern, na.rm = TRUE)/n())
  
  
  #partisan difference
  analysis %>% 
    ungroup() %>% 
  group_by(pid3) %>% 
  summarise(partisan_concern = sum(COVID_concern, na.rm = TRUE)/n())


#proportion of respondents concerned about COVID over time
analysis %>% 
  ggplot(aes(x = date, y = prop_concerned_daily)) +
  geom_line()
  

cdc_cleaned %>% 
  ggplot(aes(x = date, y = US_new_cases)) +
  geom_line()
  




```

```{r, test run}

test <- cleaned_merged %>%
  filter(date >= "2020-03-19" & date <= "2020-04-01") %>% 
  filter(pid3 %in% c(1,2)) %>% 
  mutate(dem_concern = ifelse(pid3 == 1, covid_concern, NA),
         rep_concern = ifelse(pid3 == 2, covid_concern, NA)) %>% 
  group_by(date) %>% 
  mutate(avg_concern = mean(covid_concern, na.rm = TRUE),
         dem_avg_concern = mean(dem_concern, na.rm = TRUE),
         rep_avg_concern = mean(rep_concern, na.rm = TRUE)) %>% 
  mutate(partisan_diff = dem_avg_concern - rep_avg_concern)


test %>% 
  ggplot(aes(x = date, y = avg_concern, color =  as.factor(pid3))) +
  geom_line()


test %>% 
  ggplot(aes(x = date, y = partisan_diff)) +
  geom_line()
  



```

